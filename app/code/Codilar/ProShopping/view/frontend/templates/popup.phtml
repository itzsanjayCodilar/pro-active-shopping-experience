<?php
    /** @var $block \Codilar\ProShopping\Block\ShoppingBlock */

    /** @var \Codilar\ProShopping\ViewModel\ProShop $viewModel */
    $viewModel = $block->getData('viewModel');
    $products = $viewModel->getRecommendedProduct();

    if ($this->isPopupEnabled() && $this->isContactEnabled()) {
        ?>


<script type="text/javascript">
    require(['jquery', // jquery Library

       // Magento text translate (Validation message translte as per language)

        // Jquery Validation Library
        'jquery/ui' // Jquery UI Library
    ], function ($) {
        $('#pop_button').click(function() {
         if($(this).css("margin-left") == "300px" || $(this).css("margin-left") == "280px")
        {
            $('.popup').animate({"margin-left": '-=300'});
            $('#pop_button').animate({"margin-left": '-=280'});
        }
        else
        {
            $('.popup').animate({"margin-left": '+=300'});
            $('#pop_button').animate({"margin-left": '+=280'});
        }
    });

        $('#pop_button-right').click(function() {


        if($(this).css("margin-right") == "300px" || $(this).css("margin-right") == "280px")
        {
            $('.popup-right').animate({"margin-right": '-=300'});
            $('#pop_button-right').animate({"margin-right": '-=280'});
        }
        else
        {
            $('.popup-right').animate({"margin-right": '+=300'});
            $('#pop_button-right').animate({"margin-right": '+=280'});
        }
    });

    });
    function myFunction() {
        var exists = document.getElementById("g-recaptcha-response");

    if(exists == null){
            //alert('not exists');
    }
    else {
        var check = document.getElementById("g-recaptcha-response").value;
       // alert(check);
        if(check=='' || check == null){
            document.getElementById("recaptcha").style.border = "1px solid #ea0e0e";
            return false;
        }
        else{
            document.getElementById("recaptcha").style.border = "none";
            return true;
        }
    }
}

</script>

<div id="leftcontact" <?php if ($this->popupposition() == 0) {
            echo "class=popup";
        } else {
            echo "class=popup-right";
        } ?>
     data-value="hide">
<div id="bcontactForm" name="bMyform" class="block contactFormheader">

    <?php if ($viewModel->getWelcomeMessageEnabled()) { ?>
        <h2><?php echo $viewModel->getWelcomeMessage() ?></h2>
        <h3><?php echo $viewModel->getConfirmMessage() ?></h3>
        <button id="yes">Yes</button>
        <button onclick='document.getElementById("message").innerHTML = "Thank You!"'>No</button>
        <h2 id="message"></h2>
    <?php } ?>

    <div class="category-container"></div>
    <div id="budget-div" style="display: none;">
        <label for="budget">What is your budget?</label>
        <div>
            <button class="budget-button" data-budget="15000">15k</button>
            <button class="budget-button" data-budget="5000">5k</button>
            <button class="budget-button" data-budget="10000">10k</button>
        </div>
    </div>
    <!-- New div to display products -->
    <div id="product-container"></div>
    <div id="specification-section" style="display: none;">
        <h2>Specifications</h2>
        <div id="ram"></div>
        <div id="storage"></div>
        <div id="battery"></div>
    </div>

</div>
</div>

<div <?php if ($this->popupposition() == 0) {
            echo "class=share_box";
        } else {
            echo "class=share_box-right";
        } ?>
    <?php if ($this->popupposition() == 0) {
            echo "id=pop_button";
        } else {
            echo "id=pop_button-right";
        } ?>>
        <img src="<?php echo $this->getViewFileUrl('Codilar_ProShopping::images/tss-t.png'); ?>" id="popUpButton">
</div>

<?php
    } ?>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
    jQuery(document).ready(function () {
        let categories;
        $('#yes').on('click', function () {
            let categoryUrl = "<?= $viewModel->getCategoryUrl() ?>";
            $.ajax({
                url: categoryUrl,
                type: 'POST',
                dataType: 'json',
                success: function (response) {
                    categories = JSON.parse(response.output);
                    categories.forEach(function (category) {
                        let element = `<p class='category-link' data-category-id='${category.id}'>${category.name}</p>`;
                        $('.category-container').append(element);
                    });

                    jQuery('.category-link').on('click', function () {
                        // Get the data-category-id attribute value of the clicked element
                        categoryId = $(this).data('category-id');
                        // Hide the specification section if it was shown previously
                        // Show the budget buttons
                        $('#budget-div').show();
                    });
                    $('.budget-button').on('click', function () {
                        // Get the budget value from the data attribute of the clicked button
                        const budget = $(this).data('budget');

                        // Hide the budget buttons after selecting the budget
                        $('#budget-div').hide();

                        // Continue with the AJAX request and display products
                        let products;
                        let url = "<?= $viewModel->getProductCategoryUrl() ?>";
                        $.ajax({
                            url: url,
                            type: 'POST',
                            dataType: 'json',
                            data: { categoryId: categoryId, budget: budget },
                            success: function (response) {
                                products = JSON.parse(response.output);
                                // Call function to display products in the new div
                                displayProducts(products);
                                // Show the specification section
                            },
                            error: function (err) {
                                console.log(err.Message);
                            }
                        });
                    });
                },
                error: function (err) {
                    console.log(err.Message);
                }
            });
        });

        function displayProducts(products) {
            let productContainer = document.getElementById('product-container');
            productContainer.innerHTML = '';

            products.forEach(function (product) {
                let productDiv = document.createElement('div');
                productDiv.className = 'product-item';
                productDiv.innerHTML = `
            <img class="recomend-product-img" src="${product.image}" alt="${product.sku}" />
            <div class="recomend-product-details">
                    <p class="recomend-product-sku">Sku: ${product.sku}</p>
                    <p class="recomend-product-price">Price: ${Math.round(product.price)}</p>
            </div>
        `;
                productContainer.appendChild(productDiv);
            });

            // Set a fixed height for the product container
            productContainer.style.height = '300px'; // Adjust the height as needed

            // Enable vertical scrolling for the product container
            productContainer.style.overflowY = 'scroll';
        }
    });
</script>

