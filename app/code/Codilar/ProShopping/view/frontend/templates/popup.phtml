<?php
    /** @var $block \Codilar\ProShopping\Block\ShoppingBlock */

    /** @var \Codilar\ProShopping\ViewModel\ProShop $viewModel */
    $viewModel = $block->getData('viewModel');
    $categoryList = $viewModel->getAllSystemCategory();
    $products = $viewModel->getRecommendedProduct();

    if ($this->isPopupEnabled() && $this->isContactEnabled()) {
        ?>


<script type="text/javascript">
    require(['jquery', // jquery Library

       // Magento text translate (Validation message translte as per language)

        // Jquery Validation Library
        'jquery/ui' // Jquery UI Library
    ], function ($) {
        $('#pop_button').click(function() {
         if($(this).css("margin-left") == "300px" || $(this).css("margin-left") == "280px")
        {
            $('.popup').animate({"margin-left": '-=300'});
            $('#pop_button').animate({"margin-left": '-=280'});
        }
        else
        {
            $('.popup').animate({"margin-left": '+=300'});
            $('#pop_button').animate({"margin-left": '+=280'});
        }
    });

        $('#pop_button-right').click(function() {


        if($(this).css("margin-right") == "300px" || $(this).css("margin-right") == "280px")
        {
            $('.popup-right').animate({"margin-right": '-=300'});
            $('#pop_button-right').animate({"margin-right": '-=280'});
        }
        else
        {
            $('.popup-right').animate({"margin-right": '+=300'});
            $('#pop_button-right').animate({"margin-right": '+=280'});
        }
    });

    });
    function myFunction() {
        var exists = document.getElementById("g-recaptcha-response");

    if(exists == null){
            //alert('not exists');
    }
    else {
        var check = document.getElementById("g-recaptcha-response").value;
       // alert(check);
        if(check=='' || check == null){
            document.getElementById("recaptcha").style.border = "1px solid #ea0e0e";
            return false;
        }
        else{
            document.getElementById("recaptcha").style.border = "none";
            return true;
        }
    }
}

</script>

<div id="leftcontact" <?php if ($this->popupposition() == 0) {
            echo "class=popup";
        } else {
            echo "class=popup-right";
        } ?>
     data-value="hide">
<div id="bcontactForm" name="bMyform" class="block contactFormheader">

    <div class="category-container">
        <?php foreach ($products as $single) { ?>
                <p class="category-link"><?php echo $single['name'] ?></p>
        <?php } ?>
    </div>

    <div class="category-container">
        <?php foreach ($categoryList->getItems() as $category) { ?>
            <?php if ($category->getParentId()) { ?>
                <p class="category-link" data-category-id="<?php echo $category->getId(); ?>"><?php echo $category->getName(); ?></p>
            <?php } ?>
        <?php } ?>
    </div>
    <!-- New div to display products -->
    <div id="product-container"></div>

</div>
</div>

<div <?php if ($this->popupposition() == 0) {
            echo "class=share_box";
        } else {
            echo "class=share_box-right";
        } ?>
    <?php if ($this->popupposition() == 0) {
            echo "id=pop_button";
        } else {
            echo "id=pop_button-right";
        } ?>>
        <img src="<?php echo $this->getViewFileUrl('Codilar_ProShopping::images/tss-t.png'); ?>">
</div>

<?php
    } ?>

<style type="text/css">

    #recaptcha {
      display: inline-block;
      position: relative;
    }

    .share_box{
       position:fixed;
        width:40px;
        left: 0px;
        z-index: 1000;
        top: 200px;
        height: 155px;
    }
    .share_box-right{
       position:fixed;
        width:40px;
        right: 0px;
        z-index: 1000;
        top: 200px;
        height: 155px;
    }
    .rc-anchor-normal {
        height: 74px;
        width: 250px;
    }
    .popup{
       position:fixed;
        width:40px;
        left: 5px;
        z-index: 1000;
        top: 100px;
        height: 155px;
        margin-left: -300px;
    }
    .popup-right{
       position:fixed;
        width:40px;
        right: 5px;
        z-index: 1000;
        top: 100px;
        height: 155px;
        margin-right: -65px;
    }
    .contactFormheader{
        width: 253px;
        border-radius: 5px;
        float: left;
        padding-left: 0px;
        background: white;
        padding: 10px;
        height: 65vh;
    }

    .category-link{
        cursor: pointer;
    }

    .category-container {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 15px;
        padding: 10px;
        align-items: stretch;
    }

    .category-link {
        background-color: #845BB3;
        color: white;
        padding: 10px;
        text-align: center;
        box-shadow: rgba(0, 0, 0, 0.3) 0px 19px 38px, rgba(0, 0, 0, 0.22) 0px 15px 12px;
        border-radius: 5px;
    }

    #bcontactForm{
        box-shadow: rgba(0, 0, 0, 0.35) 0px 5px 15px;
    }
    #product-container {
        border: 1px solid #ccc; /* Border style */
        padding: 10px; /* Padding around the content */
        margin-top: 20px; /* Adjust margin to create space between categories and products */
        background-color: #f9f9f9; /* Background color */
        max-width: 500px; /* Set a maximum width to limit the width of the box */
        margin-left: auto; /* Center the box horizontally */
        margin-right: auto; /* Center the box horizontally */
    }

    /* Style for individual product items inside the container */
    .product-item {
        display: flex;
        align-items: center;
        padding: 5px;
        border-bottom: 1px solid #ccc; /* Add a border between each product */
    }

    .product-item img {
        width: 50px; /* Set a width for the product image */
        height: 50px; /* Set a height for the product image */
        object-fit: cover; /* Ensure the image maintains its aspect ratio */
        margin-right: 10px; /* Add some space between the image and product details */
    }

    .product-item h3 {
        margin: 0; /* Remove margin to avoid extra spacing */
    }

    .product-item p {
        margin: 0; /* Remove margin to avoid extra spacing */
    }

</style>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
    $(document).ready(function () {
        let url = "<?= $viewModel->getProductCategoryUrl() ?>";
        let categoryId;
        jQuery('.category-link').on('click', function () {
            // Get the data-category-id attribute value of the clicked element
            categoryId = $(this).data('category-id');

            let products;
            $.ajax({
                url: url,
                type: 'POST',
                dataType: 'json',
                data: { categoryId: categoryId },
                success: function (response) {
                    products = JSON.parse(response.output);
                    // Call function to display products in the new div
                    displayProducts(products);
                },
                error: function (err) {
                    console.log(err.Message);
                }
            });
        });

        function displayProducts(products) {
            let productContainer = document.getElementById('product-container');
            productContainer.innerHTML = '';

            products.forEach(function (product) {
                let productDiv = document.createElement('div');
                productDiv.className = 'product-item';
                productDiv.innerHTML = `
            <img src="${product.image}" alt="${product.sku}" />
            <h3>${product.sku}</h3>
            <p>Price: ${product.price}</p>
        `;
                productContainer.appendChild(productDiv);
            });

            // Set a fixed height for the product container
            productContainer.style.height = '300px'; // Adjust the height as needed

            // Enable vertical scrolling for the product container
            productContainer.style.overflowY = 'scroll';
        }
    });
</script>
